<ng-container *transloco="let t; prefix: 'annotation-card'">
  <div class="card annotation-card border-0 shadow-sm mb-3">
    <div #username class="card-header d-flex justify-content-between align-items-center py-2 px-3 clickable" [ngStyle]="{'background-color': titleColor()}" (click)="viewAnnotation()">
      <div class="d-flex align-items-center">
        <strong [style.color]="colorscapeService.getContrastingTextColor(username)">{{ annotation().ownerUsername }}</strong>
      </div>
      <div  [style.color]="colorscapeService.getContrastingTextColor(username)" class="ms-2">{{ annotation().createdUtc | utcToLocaleDate | date: 'shortDate' }}</div>
    </div>

    <div class="card-body px-3 py-2">

      <blockquote class="mb-2 text-muted small fst-italic fw-lighter">
        <p class="content-quote">{{annotation().selectedText}}</p>
      </blockquote>

      <div class="mb-2 small text-muted">
        @let content = annotation().comment;
        @if (content !== '\"\"') {
          <quill-view [content]="annotation().comment" format="json" theme="snow"></quill-view>
        } @else {
          {{null | defaultValue}}
        }
      </div>
    </div>

    <div class="card-footer d-flex justify-content-between align-items-center py-2 px-3">
      @if(annotation().containsSpoiler) {
        <div class="d-flex align-items-center">
          <span class="small text-muted">
            <i class="fa-solid fa-circle-exclamation me-1" aria-hidden="true"></i>
            {{t('contains-spoilers-label')}}
          </span>
        </div>
      }

      <div class="d-flex align-items-center gap-2">

        @if(showInReaderLink()) {
          <a target="_blank" [routerLink]="['/library', annotation().libraryId, 'series', annotation().seriesId, 'book', annotation().chapterId]"
             [queryParams]="{annotation: annotation().id, incognitoMode: false}">{{t('view-in-reader-label')}}</a>
        }


        @if(showPageLink()) {
          <span class="badge bg-secondary clickable" (click)="loadAnnotation()">{{t('page-num', {page: annotation().pageNumber})}}</span>
        }


        @if (false) {
          <button class="btn btn-sm btn-outline-primary">
            <i class="fa-solid fa-thumbs-up" aria-hidden="true"></i>
          </button>
        }

        @if(allowEdit()) {
          <button class="btn btn-sm btn-outline-secondary" (click)="editAnnotation()">
            <i class="fa-solid fa-pen-alt" aria-hidden="true"></i>
          </button>
          <button class="btn btn-sm btn-outline-danger" (click)="deleteAnnotation()">
            <i class="fa-solid fa-trash-can" aria-hidden="true"></i>
          </button>
        }
      </div>
    </div>
  </div>

</ng-container>
