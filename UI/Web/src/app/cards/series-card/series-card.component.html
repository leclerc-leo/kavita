<ng-container *transloco="let t; prefix: 'card-item'">
  <div class="card-item-container card position-relative {{selected ? 'selected-highlight' : ''}}">
    <div class="overlay" (click)="handleClick()">
      @if (series.pages > 0) {
        <app-image height="232.91px" width="160px" [styles]="{'border-radius': '.25rem .25rem 0 0'}" [imageUrl]="imageService.getSeriesCoverImage(series.id)" />
      } @else if (series.pages === 0) {
        <app-image height="232.91px" width="160px" [styles]="{'border-radius': '.25rem .25rem 0 0'}" [imageUrl]="imageService.errorImage" />
      }

      @if (series.hasUserRated) {
        <div class="user-rating-badge">
          <i class="fa-solid fa-star text-warning"></i>
          <span>{{ series.userRating | number:'1.1-1' }}</span>
        </div>
      }

      <div class="progress-banner">
        @if (series.pagesRead > 0 && series.pagesRead < series.pages && series.pages > 0 && series.pagesRead !== series.pages) {
          <p ngbTooltip="{{((series.pagesRead / series.pages) * 100) | number:'1.0-1'}}%" container="body">
            <ngb-progressbar type="primary" height="5px" [value]="series.pagesRead" [max]="series.pages" />
          </p>
        }

        <span class="download">
          <app-download-indicator [download$]="download$" />
        </span>
      </div>

      @if(series.pages === 0) {
        <div class="error-banner">
          {{t('cannot-read')}}
        </div>
      }

      @if (series.pagesRead === 0 && series.pages > 0) {
        <div class="badge-container">
          <div class="not-read-badge"></div>
        </div>
      }

      @if (allowSelection) {
        <div class="bulk-mode {{bulkSelectionService.hasSelections() ? 'always-show' : ''}}" (click)="handleSelection($event)">
          <input type="checkbox" class="form-check-input" attr.aria-labelledby="{{series.id}}" [ngModel]="selected" [ngModelOptions]="{standalone: true}">
        </div>
      }

      @if (count > 1) {
        <div class="count">
          <span class="badge bg-primary">{{count}}</span>
        </div>
      }

      <div class="card-overlay"></div>
      @if (!bulkSelectionService.hasSelections()) {
        <div class="series overlay-information">
          <div class="overlay-information--centered">
              <span class="card-title library mx-auto" style="width: auto;" (click)="read($event)">
                <!-- Card Image -->
                <div>
                  <i class="fa-solid fa-book" aria-hidden="true"></i>
                </div>
              </span>
          </div>
        </div>
      }

    </div>
    <div class="card-title-container d-flex align-items-center py-1">
      <div class="d-flex flex-column flex-grow-1 justify-content-center overflow-hidden" style="min-width: 0;">
        
        <span class="card-title text-truncate w-100 text-start" [ngbTooltip]="series.name" placement="top" id="{{series.id}}" style="line-height: 1.2;">
          <a class="dark-exempt btn-icon" routerLink="/library/{{libraryId}}/series/{{series.id}}">
            {{series.name}}
          </a>
        </span>

        @if (series.lastAddedVolume > 0 || series.lastAddedChapter > 0) {
          <div class="text-muted text-truncate" style="font-size: 0.75rem; line-height: 1.1; opacity: 0.8;">
            Latest
            @if (series.lastAddedVolume > 0) { Vol. {{series.lastAddedVolume}} }
            @if (series.lastAddedVolume > 0 && series.lastAddedChapter > 0) { - }
            @if (series.lastAddedChapter > 0) { Ch. {{series.lastAddedChapter | number:'1.0-2'}} }
          </div>
        }
      </div>

      @if (actions && actions.length > 0) {
        <span class="card-actions">
            <app-card-actionables [entity]="series" [actions]="actions" [labelBy]="series.name" />
        </span>
      }
    </div>

  </div>

</ng-container>
